---
// Newsletter component for Astro
---

<section class="py-12 px-6 bg-stone-900 dark:bg-stone-950 text-white">
  <div class="max-w-xl mx-auto text-center">
    <h3 class="font-serif text-3xl md:text-4xl mb-6 text-white">Únete al Jardín</h3>
    <p class="text-stone-300 mb-10 font-light text-base leading-relaxed max-w-lg mx-auto">
      Recibe nuevos artículos y reflexiones directamente.
    </p>
    
    <div class="max-w-md mx-auto">
      <form id="newsletter-form" class="bg-white/5 backdrop-blur-sm border border-white/10 rounded-lg p-2 shadow-2xl hover:shadow-3xl transition-all duration-300 group">
        <div class="flex flex-col sm:flex-row items-stretch gap-0">
          <input
            type="email"
            id="newsletter-email"
            placeholder="tu@sagrada.com"
            required
            class="flex-1 px-6 py-4 bg-transparent text-white placeholder-stone-400 focus:placeholder-stone-300 outline-none transition-all duration-300 text-center sm:text-left"
          />
          <button
            type="submit"
            id="newsletter-submit"
            class="bg-white text-stone-900 px-8 py-4 text-xs font-bold uppercase tracking-widest hover:bg-stone-100 transition-all duration-300 rounded-md sm:rounded-l-none sm:rounded-r-md mt-2 sm:mt-0 shadow-lg hover:shadow-xl"
          >
            Suscribirse
          </button>
        </div>
      </form>
      
      <div id="newsletter-message" class="mt-4 hidden"></div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('newsletter-form');
    const email = document.getElementById('newsletter-email');
    const submit = document.getElementById('newsletter-submit');
    const message = document.getElementById('newsletter-message');
    
    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      submit.textContent = 'Enviando...';
      submit.disabled = true;
      
      try {
        const response = await fetch('https://api.brevo.com/v3/contacts', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'api-key': 'xkeysib-a8b9c1d2e3f4g5h6i7j8k9l0m1n2o3p4q5r6s7t8u9v0w1x2y3z4a5b6c7d8e9f0-1234567890abcdef'
          },
          body: JSON.stringify({
            email: email.value,
            listIds: [4],
            updateEnabled: true
          })
        });
        
        if (response.ok) {
          message.innerHTML = '<div class="bg-white/10 backdrop-blur-sm p-6 border border-white/20 text-white font-serif italic text-lg rounded-lg shadow-2xl">Gracias. Tu viaje ha comenzado.</div>';
          message.classList.remove('hidden');
          form.style.display = 'none';
        } else {
          throw new Error('Error en la suscripción');
        }
      } catch (error) {
        message.innerHTML = '<div class="bg-red-500/10 backdrop-blur-sm p-6 border border-red-500/20 text-white font-serif italic text-lg rounded-lg shadow-2xl">Error al suscribirse. Inténtalo de nuevo.</div>';
        message.classList.remove('hidden');
        submit.textContent = 'Suscribirse';
        submit.disabled = false;
      }
    });
  });
</script>